# designed by LVTheir
# implemented by PolkTech

namespace = flavour_kimanis

country_event = { # something ferments in kimanis
	id = flavour_kimanis.1
	title = flavour_kimanis.1.t
	desc = flavour_kimanis.1.d
	picture = TODO
	is_triggered_only = yes

	trigger = {
		religion = kheionism
		capital_scope = {
			region = alecand_region
		}
		owns = 2732
		is_year = 1460
		NOT = { tag = G61 }
	}

	option = { # increase the garrisons!
		name = flavour_kimanis.1.a
		ai_chance = {
			factor = 75
		}
		add_manpower = -5
		every_owned_province = {
			limit = {
				is_core = G61
			}
			add_province_modifier = { 
				name = G61_oppressed_population
				duration = 9125 # 25y
			}
		}
	}
	option = { # it will be fine!
		ai_chance = {
			factor = 25
		}
		name = flavour_kimanis.1.b 
		custom_tooltip = G61_something_ferments_tt
		set_global_flag = G61_independence_buff
	}
}

country_event = { # night at odeinostros
	id = flavour_kimanis.2
	title = flavour_kimanis.2.t
	desc = flavour_kimanis.2.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.2.a
		ai_chance = { factor = 1 }
		
		2732 = {
			add_or_upgrade_tax_building = yes
		}
		add_country_modifier = {
			name = G61_illustrious_illusions
			duration = 9125 # 25y
		}
	}
}

country_event = { # all's well that ends well
	id = flavour_kimanis.3
	title = flavour_kimanis.3.t
	desc =  flavour_kimanis.3.d

	picture = TODO
	is_triggered_only = yes


	option = {
		name = flavour_kimanis.3.a
		ai_chance = { factor = 1 }
		
		if = { # has exile to return?
			limit = { has_country_flag = G61_heroic_ruler_exiled }
			set_ruler = G61_heroic_ruler
		}
		
		
		change_mil = 1
		if = {
			limit = { has_country_flag = G61_highest_indep_rewards }
			add_prestige = 75
			add_treasury = 600
			add_adm_power = 200
			add_dip_power = 200
			add_mil_power = 200
		}
		else_if = {
			limit = { has_country_flag = G61_higher_indep_rewards }
			add_prestige = 50
			add_treasury = 400
			add_adm_power = 150
			add_dip_power = 150
			add_mil_power = 150
		}
		else_if = {
			limit = { has_country_flag = G61_normal_indep_rewards }
			add_prestige = 25
			add_treasury = 200
			add_adm_power = 100
			add_dip_power = 100
			add_mil_power = 100
		}
	}

	after = {
		# house cleaning
		set_country_flag = G61_independence_war_over
		clr_country_flag = G61_normal_indep_rewards
		clr_country_flag = G61_higher_indep_rewards
		clr_country_flag = G61_highest_indep_rewards
		clr_country_flag = G61_stab_refund

		clr_global_flag = G61_independence_buff
		clear_global_event_target = oppressor_kimanis
	}
}

country_event = { # tasteful invitation
	id = flavour_kimanis.4
	title = flavour_kimanis.4.t
	desc = {
		trigger = {
			has_country_flag = G61_4_replant_last
		}
		desc = flavour_kimanis.4.d1
	}
	desc = {
		trigger = {
			has_country_flag = G61_4_power_last
		}
		desc = flavour_kimanis.4.d2
	}
	desc = {
		trigger = {
			has_country_flag = G61_4_magos_last
		}
		desc = flavour_kimanis.4.d3
	}

	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.4.a
		ai_chance = { factor = 1 }
		
		country_event = {
			id =  flavour_kimanis.5  
			days = 30
		}
	}
	after = {
		clr_country_flag = G61_4_replant_last
		clr_country_flag = G61_4_power_last
		clr_country_flag = G61_4_magos_last
	}
}

country_event = { # looking into the bottle
	id = flavour_kimanis.5
	title = flavour_kimanis.5.t
	desc = flavour_kimanis.5.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.5.a
		ai_chance = { factor = 1 }
		
		force_add_normal_ruler_personality = { personality = sinner_personality }
		add_adm_power = 100
		add_mil_power = 100
		add_dip_power = 100
		country_event = {
			id = flavour_kimanis.6
			days = 30
		}
	}
}

country_event = { # over a cup of wine
	id = flavour_kimanis.6
	title = flavour_kimanis.6.t
	desc = flavour_kimanis.6.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.6.a
		ai_chance = { factor = 1 }
		
		if = {
			limit = {
				ai = no
			}
			custom_tooltip = G61_cooperation_with_winecults_tt
			set_country_flag = G61_cooperation_with_winecults # enable coopertion with winecults
		}
		add_country_modifier = {
			name = G61_under_wine_stupor
			duration = -1
		}
	}
}

country_event = { # opening our arms
	id = flavour_kimanis.7
	title = flavour_kimanis.7.t
	desc = flavour_kimanis.7.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.7.a
		ai_chance = { factor = 1 }

		add_country_modifier = {
			name = G61_to_be_a_good_parent
			duration = 9125 # 25y
		}
	}
}

province_event = { # hidden event for ek mechanes magos to add the province modifier
	id = flavour_kimanis.8
	title = flavour_kimanis.8.t
	desc = flavour_kimanis.8.d
	picture = TODO
	is_triggered_only = yes
	hidden = yes

	option = {
		name = flavour_kimanis.8.a
		ai_chance = { factor = 1 }

		add_province_modifier = {
			name = G61_odeinostros
			duration = -1
		}
	}
}

country_event = { # Gambit of [Root.Monarch.GetName]
	id = flavour_kimanis.9
	title = flavour_kimanis.9.t 
	desc = flavour_kimanis.9.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.9.a
		ai_chance = { factor = 1 }

		country_event = {
			id = flavour_kimanis.13
			days = 3
		}
	}
}

country_event = { # ...and paying it's price
	id = flavour_kimanis.11
	title = flavour_kimanis.11.t
	desc = flavour_kimanis.11.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.11.a
		ai_chance = { factor = 50 }

		add_army_professionalism = -0.05
		add_loot_from_province_effect_twice = yes
		2731 = { # oktikheion
			add_devastation = 75
		}
		2736 = { # degakheion
			add_devastation = 75
		}

	}
	option = {
		name = flavour_kimanis.11.b
		ai_chance = { factor = 25 }

		add_prestige = 10
		2731 = { # oktikheion
			add_devastation = 75
		}
		2736 = { # degakheion
			add_devastation = 75
		}
	}
	option = {
		name = flavour_kimanis.11.c
		ai_chance = { factor = 25 }

		add_army_professionalism = 0.05
		add_prestige = 10
		add_years_of_income = -0.25
		2731 = { # oktikheion
			add_devastation = 25
		}
		2736 = { # degakheion
			add_devastation = 25
		}

	}
}

country_event = { # the general's troupe
	id = flavour_kimanis.12
	title = flavour_kimanis.12.t
	desc = flavour_kimanis.12.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.12.a
		ai_chance = { factor = 1 }

		add_country_modifier = {
			name = G61_degali_aispotedegis
			duration = -1
		}
	}
}

country_event = { # Hear me, Hounds of Askóvoinos!
	id = flavour_kimanis.13
	title = flavour_kimanis.13.t
	desc = flavour_kimanis.13.d
	picture = TODO
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			2732 = {
				export_to_variable = {
					which = kimanis_manpower_G61
					value = base_manpower
				}
			}
		}
	}

	option = {
		name = flavour_kimanis.13.a
		ai_chance = { factor = 1 }

		custom_tooltip = G61_gambit_of_monarch_tt
		tooltip = {
			add_country_modifier = {
				name = G61_the_demagogues
				duration = -1
			}
		}
		custom_tooltip = G61_gambit_of_monarch_part2_tt
		custom_tooltip = G61_manpower_capital_tt
		hidden_effect = {
			every_owned_province = {
				limit = {
					has_province_flag = G61_had_wine_cults
				}
				kimanis_wine_cultists = 1
			}
			random_owned_province = { # fallback
				limit = {
					is_in_capital_area = yes
				}
				kimanis_wine_cultists = 1
			}

			2732 = { 
				add_province_triggered_modifier = G61_rebel_checker_ptm

				# add manpower per mil dev in kimanis province
				while = {
					limit = { 
						2732 = {
							check_variable = {
								which = kimanis_manpower_G61
								value = 1
							} 
						}
						
					}
					G61 = {
						add_manpower = 1
					}
					2732 = {
						subtract_variable = {
							which = kimanis_manpower_G61
							value = 1
						}
					}
				}
			}
		}
	}
}

country_event = { # cuirass of brass, crown of laurel
	id = flavour_kimanis.14
	title = flavour_kimanis.14.t
	desc = flavour_kimanis.14.d
	picture = TODO
	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = flavour_kimanis.14.a
		ai_chance = { factor = 1 }

		add_stability = 3
		remove_country_modifier = G61_under_wine_stupor
		add_country_modifier = {
			name = G61_the_demagogues
			duration = -1
		}
	}
}

province_event = { # planting the vines
	id = flavour_kimanis.15
	title = flavour_kimanis.15.t
	desc = flavour_kimanis.15.d
	picture = TODO
	is_triggered_only = yes

	immediate = {
		hidden_effect  = {
			owner = {
				change_variable = {
					which = vinecount_G61
					value = 1
				}
				if = {
					limit = {
						check_variable = {
							which = vinecount_G61
							value = 10
						}
					}
					clr_country_flag = G61_vine_planting
				}
			}
		}
	}

	option = {
		name = flavour_kimanis.15.a
		ai_chance = { factor = 66 }

		change_trade_goods = wine
		add_province_modifier = {
			name = G61_kimabhen_wine_expertise
			duration = -1
		}
	}
	option = {
		name = flavour_kimanis.15.b
		ai_chance = { factor = 33 }

		change_trade_goods = dyes
		add_province_modifier = {
			name = G61_kimabhen_dyes_expertise
			duration = -1
		}
	}
}
country_event = { # event for fear and loathing spell effect override
	id = flavour_kimanis.16
	title = flavour_kimanis.16.t
	desc = flavour_kimanis.16.d
	picture = PANIC_eventPicture
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.16.a
		ai_chance = { factor = 1 }
		
		tooltip = { capital_scope = { kimanis_wine_cultists = 1 } }
	}
}

country_event = { # event to show G61_glorious_battle_buff
	id = flavour_kimanis.17
	title = flavour_kimanis.17.t
	desc = flavour_kimanis.17.d
	picture = PANIC_eventPicture
	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = G61_glorious_battle_buff_event_flag }
	}
	immediate = {
		hidden_effect = {
			set_country_flag = G61_glorious_battle_buff_event_flag
		}
	}

	option = {
		name = flavour_kimanis.17.a
		ai_chance = { factor = 1 }
		custom_tooltip = G61_glorious_battle_buff_event_tt
		tooltip = {
			add_country_modifier = {
				name = G61_glorious_battle_buff
				duration = 365
			}
		}
	}
}



country_event = { # winecultists spread - on biyearly pulse
	id = flavour_kimanis.18
	title = flavour_kimanis.18.t
	desc = flavour_kimanis.18.d
	picture = TODO
	is_triggered_only = yes
	hidden = yes

	option = {
		name = flavour_kimanis.18.a
		random_province = { # run one
			limit = {
				has_province_modifier = G61_wine_cult
				any_neighbor_province = {
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 30
						}
					}
					NOT = { has_province_modifier = G61_wine_cult_cooldown }
					owner = {
						NOT = { has_country_modifier = G61_wine_cult_cooldown_country }
					}
				}
			}
			random_neighbor_province = {
				limit = {
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 30
						}
					}
					NOT = { has_province_modifier = G61_wine_cult_cooldown }
					owner = {
						NOT = { has_country_modifier = G61_wine_cult_cooldown_country }
					}
				}
				G61_add_wine_cults = yes
			}
		}

		random_province = { # run two
			limit = {
				has_province_modifier = G61_wine_cult
				any_neighbor_province = {
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 30
						}
					}
					NOT = { has_province_modifier = G61_wine_cult_cooldown }
					owner = {
						NOT = { has_country_modifier = G61_wine_cult_cooldown_country }
					}
				}
			}

			random_neighbor_province = {
				limit = {
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 30
						}
					}
					NOT = { has_province_modifier = G61_wine_cult_cooldown }
					owner = {
						NOT = { has_country_modifier = G61_wine_cult_cooldown_country }
					}
				}
				G61_add_wine_cults = yes
			}
		}
	}
}
country_event = { # Gambit failed
	id = flavour_kimanis.19
	title = flavour_kimanis.19.t
	desc = flavour_kimanis.19.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.19.a
		add_prestige = -10
	}
}

country_event = { # show the effect of starting the war
	id = flavour_kimanis.20
	title = flavour_kimanis.20.t
	desc = flavour_kimanis.20.d
	picture = TODO
	is_triggered_only = yes

	option = {
		name = flavour_kimanis.20.a
		ai_chance = { factor = 1 }
		
		if = {
			limit = { has_global_flag = G61_independence_buff }
			custom_tooltip = G61_for_kimanis_tt_1
			add_country_modifier = {
				name = G61_hidden_weapon_caches
				duration = 1825 # 5y
			}
			add_treasury = 100
		}
		if = {
			limit = { has_country_flag = G61_stab_refund }
			custom_tooltip = G61_for_kimanis_tt_2
			add_stability = 3
		}
		custom_tooltip = G61_for_kimanis_tt_3
		hidden_effect = {
			add_manpower = 10
			event_target:oppressor_kimanis = {
				trigger_switch = { # is it kinda unecessary? yeah, but it's fancy
					on_trigger = total_development
					200 = {
						G61 = { set_country_flag = G61_highest_indep_rewards }
					}
					100 = {
						G61 = { set_country_flag = G61_higher_indep_rewards }
					}
					1 = {
						G61 = { set_country_flag = G61_normal_indep_rewards }
					}
				}
				declare_war_with_cb = {
					who = G61
					casus_belli = cb_core
					war_goal_province = 2732
				}
				if = { # if player is a rival of kimanis revolt tag, they can 100% intervene
					limit = {
						any_enemy_country = {
							capital_scope = { superregion = kheionai_superregion }
							ai = no
						}
					}
					random_enemy_country = {
						limit = {
							capital_scope = { superregion = kheionai_superregion }
							ai = no
						}
						country_event = { id = kheionai_flavour.2 } # intervene in kimanis
					}
				}
				else = { # no player is a rival of kimanis, so a random rival intervenes
					random_enemy_country = {
						limit = {
							capital_scope = { superregion = kheionai_superregion }
							is_at_war = NO
						}
						country_event = { id = kheionai_flavour.2 } # intervene in kimanis
					}
				}
			}
		}
		
	}
}

country_event = {
	id = flavour_kimanis.21
	title = flavour_kimanis.21.t
	desc = flavour_kimanis.21.d
	picture = TODO
	is_triggered_only = yes

	option = { # yes
		name = flavour_kimanis.21.a
		ai_chance = { factor = 100 }
		custom_tooltip = G62_will_become_subject
		hidden_effect = {
			G61 = {
				create_subject = {
					subject_type = nekhei
					subject = G62
				}
				every_owned_province = {
						limit = {
								superregion = kheionai_superregion
								is_city = yes
								NOT = {
										region = alecand_region
										area = anisikheion_area
										area = soreion_area
										area = vothelisi_area
								}
						}
						cede_province = G62 #Amgremos
				}
				update_nekhei_dev_modifier = yes
				
			}
		}
		
	}
	option = { # no
		name = flavour_kimanis.21.b
		ai_chance = { factor = 0 }
	}
}

province_event = { # explanation winecults for target
	id = flavour_kimanis.22
	title = flavour_kimanis.22.t
	desc = flavour_kimanis.22.d
	picture = TODO
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			owner = {
				set_country_flag = G61_wine_cult_explanation
			}
		}
	}
	option = {
		name = flavour_kimanis.22.a
		ai_chance = { factor = 1 }
		goto = ROOT
		
		custom_tooltip = G61_winecult_spread_tt
	}
}