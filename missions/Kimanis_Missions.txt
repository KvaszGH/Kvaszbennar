# designed by LVTheir
# implemented by PolkTech

# TODO: highlights

kimanis_1_missions = {
	slot = 1
	generic = no
	ai = yes	
	has_country_shield = yes
	potential = {
		tag = G61
	}
	G61_oh_strayed_child = {
		icon = secure_the_republic
		position = 2
		required_missions = {
			G61_heroic_play
		}

		provinces_to_highlight = { # capital of G62 unless diplo done
			is_capital_of = G62
			ROOT = {
				NOT = {
					AND = {
						OR = {
							alliance_with = G62
							has_guaranteed = G62
						}
						G62 = {
							has_opinion = {
								who = ROOT
								value = 125
							}
						}
					}
				}
			}
		}
		trigger = {
			if = {
				limit = { exists = G62 }
				OR = {
					alliance_with = G62
					has_guaranteed = G62
				}
				G62 = {
					has_opinion = {
						who = ROOT
						value = 125
					}
				}
			}
			navy_size_percentage = 0.9
			num_of_admirals = 1
			if = {
				limit = { num_of_geobukseon = 5 } #Degarikes
				dip_power = 0
			}
			else_if = {
				limit = { num_of_geobukseon = 4 } #Degarikes
				dip_power = 10
			}
			else_if = {
				limit = { num_of_geobukseon = 3 } #Degarikes
				dip_power = 20
			}
			else_if = {
				limit = { num_of_geobukseon = 2 } #Degarikes
				dip_power = 30
			}
			else_if = {
				limit = { num_of_geobukseon = 1 } #Degarikes
				dip_power = 40
			}
			else = {
				dip_power = 50
			}
		}

		effect = {
			custom_tooltip = G61_oh_strayed_child_cost_tt # costs 50 dip, lowered by 10 for each degarikes we own
			if = {
				limit = { num_of_geobukseon = 5 } #Degarikes
				# do nothing :)
			}
			else_if = {
				limit = { num_of_geobukseon = 4 } #Degarikes
				add_dip_power = -10
			}
			else_if = {
				limit = { num_of_geobukseon = 3 } #Degarikes
				add_dip_power = -20
			}
			else_if = {
				limit = { num_of_geobukseon = 2 } #Degarikes
				add_dip_power = -30
			}
			else_if = {
				limit = { num_of_geobukseon = 1 } #Degarikes
				add_dip_power = -40
			}
			else = {
				add_dip_power = -50
			}
			
			country_event = {
				id = flavour_kimanis.7 # opening our arms
			}
		}
	}
	G61_glorious_nostos = {
		icon = mission_reliable_allies
		position = 4
		required_missions = {
			G61_oh_strayed_child
			G61_towards_the_greener_fields
		}
		provinces_to_highlight = { # capital of G62 unless diplo done
			is_capital_of = G62
			ROOT = {
				NOT = {
					AND = {
						G62 = {
							subsidised_percent_amount = {
								value = 0.25
							}
							trust = {
								who = ROOT
								value = 70
							}
						}
					}
				}
			}
		}
		trigger = {
			G62 = {
				subsidised_percent_amount = {
					value = 0.25
				}
				trust = {
					who = ROOT
					value = 70
				}
			}
			OR = {
				statesman = 2
				diplomat = 2
				has_dip_advisor_3 = yes
			}
		}
		effect = {
			if = { # gain trade war cb on owner of ameion province for 100 years
				limit = { NOT = { owns = 2620 } } # ameion
				2620 = {
					owner = {
						reverse_add_casus_belli = {
							type = cb_trade_war_triggered
							target = ROOT
							months = 1200
						}
					}
				}
			}
			G62 = {
				country_event = { id = flavour_kimanis.21 }
			}
		}
	}

}

kimanis_2_missions = {
	slot = 2
	generic = no
	ai = yes	
	has_country_shield = yes
	potential = {
		tag = G61
	}

	G61_heroic_play = {
		icon = mission_horse_siege
		position = 1
		provinces_to_highlight = {
			if = {
				limit = { has_saved_global_event_target = oppressor_kimanis }
				is_capital_of = event_target:oppressor_kimanis
			}
			else = {
				always = no
			}
		}
		trigger = {
			
			if = {
				limit = { has_saved_global_event_target = oppressor_kimanis }
				OR = {
					custom_trigger_tooltip = {
						tooltip = G61_heroic_play_explanation_trigger_tt_2
						is_in_war = {
							casus_belli = cb_independence_war
							defender_leader = event_target:oppressor_kimanis
						}
						any_army = { 
							is_ruler_commanding_unit = yes
							location = {
								is_capital_of = event_target:oppressor_kimanis
							}
						}
						event_target:oppressor_kimanis = {
							capital_scope = {
								sieged_by = ROOT
							}
						}
					}
					AND = {
						custom_trigger_tooltip = {
							tooltip = G61_heroic_play_explanation_trigger_tt
							NOT = { war_with = event_target:oppressor_kimanis }
						}
						stability = 1
						manpower_percentage = 0.7
					}
				}
			}
			else = {
				stability = 1
				manpower_percentage = 0.7
			}
		}

		effect = {
			add_prestige = 25
			add_war_exhaustion = -5
			custom_tooltip = G61_heroic_play_explanation_effect_tt
			if = {
				limit = { has_saved_global_event_target = oppressor_kimanis }
				tooltip = {
					define_advisor = {
						type = artist
						skill = 1
						cost_multiplier = 0.1
					}
				}
				hidden_effect = {
					if = { # at war with releaser
						limit = {
							is_in_war = {
								casus_belli = cb_independence_war
								defender_leader = event_target:oppressor_kimanis
							}
						}
						exile_ruler_as = {
							name = G61_heroic_ruler
						}
						set_country_flag = G61_heroic_ruler_exiled
						event_target:oppressor_kimanis = {
							capital_scope = {
								change_siege = 5
							}
						}
					}
					else_if = {
						limit = { is_subject = yes }
						set_country_flag = G61_stab_refund
					}
					else = {
						define_advisor = {
							type = artist
							skill = 1
							cost_multiplier = 0.1
						}
						clear_global_event_target = oppressor_kimanis
					}
				}
			}
			else = {
				define_advisor = {
					type = artist
					skill = 1
					cost_multiplier = 0.1
				}
			}
		}
	}

	G61_measuring_hybris = {
		icon = fight_bosnian_heresies
		position = 2
		required_missions = {
			G61_heroic_play
		}
		provinces_to_highlight = { # G467G47 capitals unless war won
			OR = {
				AND = {
					is_capital_of = G46
					NOT = {  ROOT = { has_won_war_against = { who = G46 } } }
				}	
				AND = {
					is_capital_of = G47
					NOT = {  ROOT = { has_won_war_against = { who = G47 } } }
				}
			}
			
		}

		trigger = {
			OR = {
				NOT = { exists = G46 } # Degakheion
				has_won_war_against = {
					who = G46
				}
			}
			OR = {
				NOT = { exists = G47 } # Oktikheion
				has_won_war_against = {
					who = G47
				}
			}
		}

		effect = {
			country_event = {
				id = flavour_kimanis.11
			}
		}
	}

	G61_towards_the_greener_fields = {
		icon = mission_wine_monopolies
		position = 3
		required_missions = {
			G61_measuring_hybris
			G61_replant_the_vines
		}
		provinces_to_highlight = {
			owned_by = ROOT
			OR = {
				has_terrain = farmlands 
				has_terrain = grasslands
			}
			devastation = 1
		}

		trigger = {
			num_of_owned_provinces_with = {
				value = 5
				OR = {
					has_terrain = farmlands
					has_terrain = grasslands
				}
			}
			all_owned_province = {
				OR = { # this way tt is nicer
					NOT = { has_terrain = farmlands has_terrain = grasslands }
					NOT = { devastation = 1 }
				}
			}
		}

		effect = {
			custom_tooltip = G61_towards_the_greener_fields_reward_tt
			hidden_effect = {
				every_owned_province = {
					limit = {
						OR = {
							has_terrain = farmlands
							has_terrain = grasslands
						}
					}
					add_nationalism = -20
					add_unrest = -5
				}
				if = {
					limit = { has_country_modifier = G61_time_of_rebuidling }
					extend_country_modifier = {
						name = G61_time_of_rebuidling
						duration = 5475 # 15y
					}
				}
			}
			
		}
	}

	G61_garments_of_actors = {
		icon = mission_son_own_develop_clothes_and_salt
		position = 4
		required_missions = {
			G61_towards_the_greener_fields
			G61_tragedy_of_kimanis
		}
		provinces_to_highlight = {
			OR = {
				AND = {
					trade_goods = silk
					ROOT ={
						NOT = {
							trade_goods_produced_amount = {
								trade_goods = silk
								amount = 10
							}
						}
					}
				}
				AND = {
					trade_goods = dyes
					ROOT ={
						NOT = {
							trade_goods_produced_amount = {
								trade_goods = dyes
								amount = 15
							}
						}
					}
				}
			}
		}
		trigger = {
			OR = {
				army_professionalism = 0.2
				AND = {
					army_professionalism = 0.1
					mil_power = 100
				}
			}
			trade_goods_produced_amount = {
				trade_goods = silk
				amount = 10
			}
			trade_goods_produced_amount = {
				trade_goods = dyes
				amount = 15
			}
		}
		effect = {
			if = {
				limit = { NOT= { army_professionalism = 0.2 } }
				add_mil_power = -100
			}
			country_event = {
				id = flavour_kimanis.12 # the generals troupe
			}
		}
	}
	G61_rival_the_ambhen_wine = {
		icon = mission_feast
		position = 5
		required_missions = {
			G61_glorious_nostos
			G61_garments_of_actors
		}
		provinces_to_highlight = {
			OR = {
				AND = {
					trade_goods = wine
					ROOT = {
						NOT = {
							development_in_provinces = {
								value = 80
								trade_goods = wine
							}
						}
					}
				}
				AND = {
					is_capital_of = G52
					ROOT = {
						NOT = {
							AND = {
								G52 = { has_been_insulted_by_root = yes }
								OR = {
									2620 = { is_blockaded_by = ROOT } # Ameion
									has_won_war_against = { who = G52 } # Ameion
								}
							}
						}
					}
					
				}
			}
		}
		trigger = {
			development_in_provinces = {
				value = 80
				trade_goods = wine
			}
			OR = {
				AND = {
					G52 = { has_been_insulted_by_root = yes }
					OR = {
						2620 = { is_blockaded_by = ROOT } # Ameion
						has_won_war_against = { who = G52 } # Ameion
					}
				}
				NOT = { exists = G52 } # Ameion
			}
			
		}
		effect = {
			set_country_flag = G61_good_wine
			custom_tooltip = G61_good_wine_tt
		}

	}

}

kimanis_3_missions = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = G61
	}

	G61_replant_the_vines = {
		icon = mission_rice_farming
		position = 2
		required_missions = {
			G61_heroic_play
			G61_restoring_the_centre
		}
		# no highlight
		provinces_to_highlight = {
			province_id = 2765
		}
		trigger = {
			owns = 2765
			OR = {
				adm_tech = 6
				treasury = 100
			}
			custom_trigger_tooltip = {
				tooltip = G61_no_deathwinds_tt
				NOT = { has_global_flag = alecand_deathwinds_active }
			}
		}
		effect = {
			if = {
				limit = { NOT = {adm_tech = 6} }
				add_treasury = -100
			}
			2765 = {
				change_trade_goods = wine
				add_or_upgrade_production_building = yes
				add_permanent_windward_level = {
					level = 1
				}
			}
			add_country_modifier = {
				name = G61_time_of_rebuidling
				duration = 9125 # 25 years
			}

			hidden_effect = {
				if = {
					limit = { mission_completed = G61_ek_mechanes_magos mission_completed = G61_power_of_presentation }
					set_country_flag = G61_4_replant_last
					country_event = { id = flavour_kimanis.4 days = 30 }
				}
			}

		}
	}

	G61_tragedy_of_kimanis = {
		icon = mission_university_of_copenhagen
		position = 3
		required_missions = {
			G61_replant_the_vines
		}
		provinces_to_highlight = {
			continent = south_america
			OR = {
				AND = { # provinces with relevant tradegood if you don't have enough already
					OR = {
						trade_goods = wool
						trade_goods = livestock
						trade_goods = incense
						trade_goods = grain
					}
					NOT = { owned_by = ROOT }
					ROOT = {
						NOT = {
							num_of_owned_provinces_with = {
								value = 10
								OR = {
									trade_goods = wool
									trade_goods = livestock
									trade_goods = incense
									trade_goods = grain
								}
							}
						}
					}
				}

				AND = { # cities if you don't have enough already
					has_terrain = city_terrain
					ROOT = {
						NOT = {
							num_of_owned_provinces_with = {
								value = 2
								has_terrain = city_terrain
								NOT = { province_id = 2732 }
							}
						}
					}
				}
			}
		}
		trigger = {
			num_of_owned_provinces_with = {
				value = 10
				OR = {
					trade_goods = wool
					trade_goods = livestock
					trade_goods = incense
					trade_goods = grain
				}
			}
			num_of_owned_provinces_with = {
				value = 2
				has_terrain = city_terrain
				NOT = { province_id = 2732 }
			}
		}
		effect = {
			custom_tooltip = G61_tragedy_of_kimanis_tt
			hidden_effect = {
				select_highest_dev_province_with_limit = { 
					limit = "has_terrain = city_terrain NOT = { province_id = 2732 } NOT = { trade_goods = silk }" 
					effect = "change_trade_goods = silk"
					index = 1
				}
				select_highest_dev_province_with_limit = { 
					limit = "has_terrain = city_terrain NOT = { province_id = 2732 } NOT = { trade_goods = silk }" 
					effect = "change_trade_goods = silk"
					index = 2
				}
				set_country_flag = G61_vine_planting
			}
		}
	}

	G61_virtue_of_boldness = { # virtue of boldness
		icon = mission_battle_of_varna
		position = 5
		required_missions = {
			G61_garments_of_actors
			G61_whispers_in_the_darks
		}
		# no highlight
		trigger = {
			custom_trigger_tooltip = {
				tooltip = G61_scornful_insult_tt
				check_variable = {
					which = scornful_insult_counter_G61
					value = 25
				}
			}
			
			has_mil_advisor_3 = yes

			custom_trigger_tooltip = {
				tooltip = glorious_battle_count_G61_tt
				check_variable = {
					which = glorious_battle_count_G61
					value = 10 
				}
			}
		}

		effect = {
			custom_tooltip = G61_glorious_battle_buff_tt
			tooltip = {
				add_country_modifier = {
					name = G61_glorious_battle_buff
					duration = 365
				}
			}
			hidden_effect = {
				set_country_flag = G61_glorious_battle_buff_flag
			}
		}
	}
}

kimanis_4_missions = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = G61
	}
	G61_restoring_the_centre = {
		icon = mission_early_game_buildings
		position = 1
		provinces_to_highlight = {
			province_id = 2732 # kimanis
		}
		trigger = {
			2732 = { # Kimanis province
				owned_by = G61
				NOT = { devastation = 1 }
				has_fort_building_trigger = yes
				num_of_times_improved_by_owner = 5
			}
		}
		effect = {
			country_event = {
				id = flavour_kimanis.2 # night at odeinostros
			}
		}
	}
	G61_power_of_presentation = {
		icon = secure_the_republic
		position = 2
		required_missions = {
			G61_restoring_the_centre	
		}
		provinces_to_highlight = {
			is_capital_of = ROOT
		}
		trigger = {
			if = {
				limit = { adm = 4 }
				#do nothing
			}
			else_if = {
				limit = { adm = 3 }
				adm_power = 25
			}
			else_if = {
				limit = { adm = 2 }
				adm_power = 50
			}
			else_if = {
				limit = { adm = 1 }
				adm_power = 75
			}
			else = {
				adm_power = 100
			}

			if = {
				limit = { dip = 4 }
				#do nothing
			}
			else_if = {
				limit = { dip = 3 }
				dip_power = 25
			}
			else_if = {
				limit = { dip = 2 }
				dip_power = 50
			}
			else_if = {
				limit = { dip = 1 }
				dip_power = 75
			}
			else = {
				dip_power = 100
			}

			if = {
				limit = { mil = 4 }
				#do nothing
			}
			else_if = {
				limit = { mil = 3 }
				mil_power = 25
			}
			else_if = {
				limit = { mil = 2 }
				mil_power = 50
			}
			else_if = {
				limit = { mil = 1 }
				mil_power = 75
			}
			else = {
				mil_power = 100
			}

			capital_scope = {
				num_of_units_in_province = {
					who = ROOT
					type = infantry
					amount = 10
				}
			}
		}
		
		effect = {
			custom_tooltip = G61_power_of_rep_mana_cost_tt
			if = {
				limit = { adm = 4 }
				#do nothing
			}
			else_if = {
				limit = { adm = 3 }
				add_adm_power = -25
			}
			else_if = {
				limit = { adm = 2 }
				add_adm_power = -50
			}
			else_if = {
				limit = { adm = 1 }
				add_adm_power = -75
			}
			else = {
				add_adm_power = -100
			}

			if = {
				limit = { dip = 4 }
				#do nothing
			}
			else_if = {
				limit = { dip = 3 }
				add_dip_power = -25
			}
			else_if = {
				limit = { dip = 2 }
				add_dip_power = -50
			}
			else_if = {
				limit = { dip = 1 }
				add_dip_power = -75
			}
			else = {
				add_dip_power = -100
			}

			if = {
				limit = { mil = 4 }
				#do nothing
			}
			else_if = {
				limit = { mil = 3 }
				add_dip_power = -25
			}
			else_if = {
				limit = { mil = 2 }
				add_dip_power = -50
			}
			else_if = {
				limit = { mil = 1 }
				add_mil_power = -75
			}
			else = {
				add_mil_power = -100
			}


			if = { # TODO custom tt?
				limit = { 
					has_kheionist_deity = { deity = maederitic_rule }
					capital_scope = {
						OR = {
							holy_order = maederitic_rule_order_level_1
							holy_order = maederitic_rule_order_level_2
							holy_order = maederitic_rule_order_level_3
						}
					}
				}
				add_republican_tradition = 15
			}
			else = {
				change_personal_deity = maederitic_rule_deity_level_1
				tooltip = {
					capital_scope = {
						holy_order = maederitic_rule_order_level_3
					}
				}
				hidden_effect = {
					capital_scope = {
						every_province_in_state = {
							holy_order = maederitic_rule_order_level_3
							clr_province_flag = has_schaal_onitheia_order_flag
							clr_province_flag = has_teachings_of_varamelas_order_flag
							clr_province_flag = has_dictats_of_isparokaeus_order_flag
							clr_province_flag = has_archatiradist_doctrine_order_flag
							clr_province_flag = has_anagbheism_order_flag
							clr_province_flag = has_axierophonic_mandate_order_flag
							clr_province_flag = has_drivos_rochos_order_flag
							clr_province_flag = has_laskaris_creed_order_flag
						}
					}
					upgrade_kheionism_deity = { deity = maederitic_rule }
				}
			}

			hidden_effect = {
				if = {
					limit = { mission_completed = G61_replant_the_vines mission_completed = G61_ek_mechanes_magos }
					set_country_flag = G61_4_power_last
					country_event = { id = flavour_kimanis.4 days = 30 }
				}
			}
		}

	}
	G61_what_lurks_below = { 
		icon = mission_dark_book
		position = 3
		required_missions = {
			G61_replant_the_vines
			G61_power_of_presentation
			G61_ek_mechanes_magos
		}
		provinces_to_highlight = {
			OR = {
				region = alecand_region
				region = devand_region
			}
			NOT = {
				has_province_modifier = G61_wine_cult
			}
		}
		trigger = {
			custom_trigger_tooltip = {
				tooltip = G61_met_wine_cults_tt
				has_country_flag = G61_cooperation_with_winecults # met the winecults in event chain
			}
			calc_true_if = { # TOOD is tt fine? is trigger fine?
				amount = 4
				alecand_region = { type = all has_province_modifier = G61_wine_cult }
				devand_region = { type = all has_province_modifier = G61_wine_cult }
			}
			calc_true_if = { # TOOD is tt fine? is trigger fine?
				amount = 2
				all_known_country = {
					has_spy_network_from = {
						who = ROOT
						value = 30
					}
				}
			}
		}

		effect = {
			custom_tooltip = G61_what_lurks_below_tt
			every_province = {
				limit = {
					has_province_modifier = G61_wine_cult
				}
				add_unrest = 10
			}
			set_country_flag = G61_wine_cult_conquest_bonus
		}

	}
	G61_whispers_in_the_darks = {
		icon = mission_blood_sacrifice
		position = 4
		required_missions = {
			G61_tragedy_of_kimanis
			G61_what_lurks_below
			G61_razzle_dazzle
		}
		provinces_to_highlight = {
			OR = {
				region = alecand_region
				region = devand_region
			}
			NOT = {
				has_province_flag = G61_had_wine_cults
			}
		}
		trigger = {
			calc_true_if = { # TODO is tt fine?
				amount = 10
				alecand_region = { 
					type = all 
					custom_trigger_tooltip = {
						tooltip = G61_province_had_wine_cults_tt
						has_province_flag = G61_had_wine_cults
					}
				}
				devand_region = {
					type = all 
					custom_trigger_tooltip = {
						tooltip = G61_province_had_wine_cults_tt
						has_province_flag = G61_had_wine_cults
					}
				}
			}
			reform_level = 4
			government_reform_progress = 50
			OR = {
				custom_trigger_tooltip = {
					tooltip = G61_whispers_in_the_darks_crown_land_tt
					crown_land_share = estate_church
				}
				estate_loyalty = {
					estate = estate_church
					loyalty = 70
				}
			}
		}

		effect = {
			add_government_reform = g61_rumoured_wine_cults
			custom_tooltip = G61_whispers_in_the_darks_reward_tt
			tooltip = {
				add_prestige = 2
				add_splendor = 20
			}
			hidden_effect = {
				every_province = { # TODO maybe track variable to show current amount?
					limit = {
						has_province_flag = G61_had_wine_cults
					}
					G61 = {
						add_prestige = 2
						add_splendor = 20
					}
				}
			}
			
		}

	}
	G61_worthy_of_gelmonias = {
		icon = republican_yearnings
		position = 5
		required_missions = {
			G61_whispers_in_the_darks
			G61_theatre_of_mind
		}
		provinces_to_highlight = {
			region = alecand_region
			NOT = {
				owned_by = ROOT
			}
		}
		trigger = {
			num_of_owned_provinces_with = {
				value = 30
				region = alecand_region
			}
			NOT = { stability = 0 }
			custom_trigger_tooltip = {
				tooltip = G61_three_reelections_tt
				check_variable = {
					which = election_term_G61
					value = 3 # 3x reelected
				}
			}
		}
		effect = {
			country_event = {
				id = flavour_kimanis.9
			}
		}
	}
}

kimanis_5_missions = {
	slot = 5
	generic = no
	ai = yes	
	has_country_shield = yes
	potential = {
		tag = G61
	}
	G61_ek_mechanes_magos = {
		icon = mission_magic_tower
		position = 2
		required_missions = {
			G61_restoring_the_centre
		}
		provinces_to_highlight = {
			province_id = 2732
		}
		trigger = {
			is_estate_illusion_level_1_minimum = yes
			has_cast_any_illusion_spell = yes
			OR = {
				artist = 1
				has_adm_advisor_2 = yes
			}
			2732 = {
				OR = {
					can_build = mage_tower
					has_building = mage_tower
				}
				
			}
		}
		effect = {
			2732 = {
				if = {
					limit = { NOT = { has_building = mage_tower } }
					add_building_construction = {
						building = mage_tower
						speed = 1
						cost = 0
					}
					hidden_effect = {
						province_event = {
							id = flavour_kimanis.8
							days = 1825 # 5y, after construction is finished
						}
					}
					custom_tooltip = G61_odeinostros_construction_tt
					tooltip = {
						2732 = {
							add_province_modifier = {
								name = G61_odeinostros
								duration = -1
							}
						}
					}
				}
				else = {
					add_province_modifier = {
						name = G61_odeinostros
						duration = -1
					}
				}
			}
			
			
			hidden_effect = {
				if = {
					limit = { mission_completed = G61_replant_the_vines mission_completed = G61_power_of_presentation }
					set_country_flag = G61_4_magos_last
					country_event = { id = flavour_kimanis.4 days = 30 }
				}
			}
		}
	}

	G61_razzle_dazzle = {
		icon = mission_magy
		position = 3
		required_missions = {
			G61_ek_mechanes_magos
		}
		# no highlight
		trigger = {
			has_cast_spell_count_trigger = { school = illusion count = 6 }
			at_least_magical_infrastructure_level_1 = yes
		}
		effect = {
			custom_tooltip = G61_razzle_dazzle_tt
			set_country_flag = G61_spell_effect_razzle
			stop_count_spells_effect = { school = illusion }
		}

	}
	G61_theatre_of_mind = {
		icon = mission_theatre_masks
		position = 4
		required_missions = {
			G61_razzle_dazzle
		}
		# no highlight
		trigger = {
			at_least_magic_project_level = { project = theatre_of_simulacra level = 1 }
			has_estate_privilege = estate_burghers_patronage_of_the_arts
			has_estate_privilege = estate_mages_magocratic_administration
		}
		effect = {
			2732 = {
				add_building = state_house
			}
			add_country_modifier = {
				name = G61_art_of_magic #  +20% mage loyalty, +10% mage influence
				duration = 10950 # 30y
			}
		}
	}
}